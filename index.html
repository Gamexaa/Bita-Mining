<!DOCTYPE html>
<html>
  <head>
    <title>Bita Mining App</title>
    <meta charset="UTF-8" />
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f9f9f9;
        color: #333;
      }
      .card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h2>Welcome to ß Mining App</h2>
    <div id="userCard" class="card">Loading user data...</div>

    <script>
      // Firebase Config
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "bita-mining.firebaseapp.com",
        projectId: "bita-mining",
        storageBucket: "bita-mining.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Telegram WebApp Integration
      const tg = window.Telegram.WebApp;
      tg.expand(); // Expand to full screen

      const user = tg.initDataUnsafe?.user;

      if (!user) {
        document.getElementById('userCard').innerText = "Please open this link inside Telegram.";
      } else {
        const userId = user.id.toString();
        const userRef = db.collection("users").doc(userId);

        userRef.get().then((doc) => {
          if (doc.exists) {
            showUser(doc.data());
          } else {
            const newUser = {
              username: user.username || "",
              first_name: user.first_name || "",
              balance: 0.015,
              referrals: []
            };
            userRef.set(newUser).then(() => showUser(newUser));
          }
        });

        function showUser(data) {
          document.getElementById('userCard').innerHTML = `
            <strong>Username:</strong> @${data.username}<br>
            <strong>Name:</strong> ${data.first_name}<br>
            <strong>Balance:</strong> ${data.balance} ß<br>
            <strong>Referrals:</strong> ${data.referrals.length}
          `;
        }
      }
    </script>
  </body>
</html>
